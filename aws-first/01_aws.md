## AWS Hands-on for Beginners
Network編#1 AWS上にセキュアなプライベートネットワーク空間を作成する

## AWSのCloudFormationとGUIを比較してみた
## AWS上にセキュアなプライベートネットワーク空間を作成できた
## AWS上にVPCの環境構築をはじめて作成してみた

https://www.youtube.com/watch?v=Y2_ALY4ZSgw

https://staff-blog.faith-sol-tech.com/toshi%E3%81%8C-aws-%E5%88%9D%E5%BF%83%E8%80%85%E5%90%91%E3%81%91%E3%83%8F%E3%83%B3%E3%82%BA%E3%82%AA%E3%83%B3%E3%82%92%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%BE%E3%81%97%E3%81%9F-%EF%BD%9E-network/

```
大枠の流れ https://aimstogeek.hatenablog.com/entry/2023/07/25/191713
1: VPCでネットワーク作成
2: ネットワーク内にサブネット4つ作成
3: インターネットゲートウェイを設定して、2/4のサブネットをパブリックサブネット化
4: パブリックサブネットにEC2を作成
5: 外部から4に接続できることを確認
6: プライベートサブネットにEC2を作成
7: PrivateEc2からNatGateWary経由で外部にアクセスできるようにする
8: PrivateからVPC Endpoint(Interface型)経由でSSMにアクセスできるようにする
9: PrivateEc2からVPC Endpoint(Gateway型)経由でS3にアクセスできるようにする
```

```
ハンズオンの概要
利用するサービス
VPC : AWS上に専用の仮想ネットワーク空間を構築します
Subnet : VPCのネットワーク空間を用途/AZ毎に分割します
Internet gateway (IGW) : インターネットと接続するためのGWです
Route table : ルーティング設定を登録します
NAT gateway : Private Subnet内からインターネットに接続する際に利用します
Endpoints : VPC内から各種AWSサービスに（IGWを利用せずに）接続する際に利用します
PrivateLink : VPC内から各種AWSサービスに（IGWを利用せずに）接続する際に利用します
Elastic IP address : 固定のパブリックIPアドレスを設定します
Systems Manager (SSM) : 今回はEC2にログインしてコマンドを実行する際に利用します
EC2 : 仮想サーバー
S3 : オブジェクトストレージ
IAM Role : 今回はEC2にSSM/S3のアクセス権を付与する際に利用します
```

## はじめに


### VPC

AWSの提供するAWSアカウント専用の仮想ネットワーク
AWSで提供されたリソースのみ設置可能
※EC2やRDSの場合、作成時にVPCを選択必須

Amazon VPCは、オンプレミスの環境で構築された社内ネットワークと同じようなプライベートネットワークを、AWS上に作成するためのサービス 
プライベートネットワークは論理的に分離され、自社専用のネットワーク空間として利用でき、IPアドレスも自社で設定可能です。作成したプライベートネットワークは、インターネットゲートウェイを介してインターネットに接続できます。
Amazon VPCで作成したプライベートネットワーク空間の中には、インターネットに公開する「パブリックサブネット」と、非公開の「プライベートサブネット」を作成できます。プライベートサブネットは、外部ネットワークとは完全に遮断されますので、安全です。
パブリックサブネットには、一般に公開するWebサーバなどのインスタンスを配置し、プライベートサブネットには、DBサーバや社内システムなど、外部からアクセスさせたくないインスタンスを配置します。

https://www.cloudsolution.tokai-com.co.jp/white-paper/2021/1025-264.html

### サブネット（1a-176）
大きなネットワークを小さく分割したネットワーク
外部のネットワークと内部ネットワーク、DMZ
パブリックサブネット：インターネットとの接続性を持っている
プライベートサブネット：遮断されている

サブネットを分けることで、サブネットごとに役割を与えられる
切り分けることで直接通信できる範囲を狭め、FWを設置してセキュリティの境界を作る目的で作る

### ゲートウェイ（1a-1３５）


- インターネットゲートウェイ

VPCとインターネット間の通信を可能にする出入口

サブネット内にあるEC2などのリソースがインターネットと通信できるように使用する機能

パブリックサブネット：IGW経由でインターネットと通信できるサブネット
プライベートサブネット：IGW経由でインターネットと通信できないサブネット

- NATゲートウェイ
Network Address Translation

NAT ゲートウェイは一方通行、片道切符だよね。 ネットワーク側からインターネット側に行くだけで、ネットワーク側からはアクセスできない
通常プライペートサブネットにあるEC2のリソースは、インターネットと疎通不可


VPC側からインターネットへ通信が一方通行設定ができ、ソフトウェアパッケージのDL時に使える。
インターネット側からVPC側への通信ができないから安全


### ルートテーブル


サブネットごとの通信設定ルール。
設定を行うことで、システムからの通信経路を制御し、安全性を確保することができます。

ルーティングはデータを転送する仕組み（1a-171）

サブネット毎の通信設定ルールです。
設定を行うことで、システムからの通信経路を制御し、安全性を確保することができます。

## セキュリティグループ
https://www.cloudsolution.tokai-com.co.jp/white-paper/2021/0719-246.html

インスタンス単位で通信の許可/禁止を設定できるファイアウォールです。
そのため、ルートテーブルより細かな通信制御が可能です。


### リージョン
国地域の概念
仮想マシーンやストレージを構成する際に、どのリージョンで動かすか決める

### AZ
一つ以上のデータセンターによって配置されている
日本では東京・大阪が存在し、地理・電源・ネットワーク的に分解されている

AWSが世界各地に配置しているリージョン内にある、1つ以上のデータセンターで構築された小さな区分けのことです。
AZ間は低遅延専用線で接続されています。


### ELB

ロードバランスサービスの総称
4種類ある


アプリケーションへのトラフィック（ネットワークを流れるデータ）の負荷分散を行うことが主な機能

- 大量のアクセスが起こった場合など振り分ける
- つうしんを振り分ける先に異常がないか確認する
- 異常を検知したら、通信を振り分けない

## 仮想サーバーの作成方法（1b-59）

### AMI
### インスタンスタイプ
### 配置するネットワーク
### データをほぞんするストレージの容量
### アクセス許可設定


---

### VPCを使用する流れ（1a-173）

- VPCを作る
  - VPC名前を設定
  - CIDRブロックの設定
  - テナンシーを選択（ハードウェアを占有するか）

- サブネットの設定
  - サブネット名を設定
  - 対象のVPCを選択
  - AZを選択
  - CIDRブロックの設定

- インターネットに接続する

  - IGWを作成
  - IGWとVPCを接続（アタッチ）
  - ルーティングの設定＝ルートテーブルの作成と設定


## Cloudformation


テンプレート：
あるべき状態を記載した設定ファイル（yaml/json）
スタック構築したいリリースの設計図
どのリソースをどのような設定で起動させるかをかく
詳細設計書やパラメーターシートに記載する内容と似ている

スタック：
リソースの集合体＝グループ
プロビジョニングとは、ITシステムやネットワークリソースを必要に応じて準備、設定、管理するプロセス

テンプレートをもとに、AWSの構築を自動化できるサービス

---

https://pages.awscloud.com/JAPAN-event-OE-Hands-on-for-Beginners-Network1-2022-reg-event.html?trk=aws_introduction_page



### Gateway型
| 特徴         | Gateway型            | Interface型                |
| ---------- | ------------------- | ------------------------- |
| 対応サービス     | S3 / DynamoDB       | ほぼ全AWSサービス（+ PrivateLink） |
| 接続方式       | ルートテーブル経由           | ENI (プライベートIP) 経由         |
| コスト        | 無料                  | 有料（時間＋通信料）                |
| セキュリティグループ | 使えない                | 使える                       |
| 利用イメージ     | S3/DynamoDB専用の専用料金所 | VPC内に専用ドアを作って直通接続         |


それぞれのゲートの役割

- Internet Gateway (IGW)  
城の正門  
外の世界（インターネット）と 双方向に通れる  
例：EC2にパブリックIPをつければ、世界中からアクセスできるし、逆に外にも出られる  

- NAT Gateway
裏口の片道ドア  
城の中から外には出られるけど、外からは入ってこられない  
例：プライベートサブネットのEC2がyum updateしたいとき  

- Gateway型 Endpoint (S3/DynamoDB専用)
城からAWSの倉庫に直通する専用通路（料金無料）  
外（インターネット）に出なくても、S3/DynamoDBには直接行ける  

- Interface型 Endpoint (他サービス)
城の壁に増設する専用ドア  
特定のAWSサービスにだけ直通できるドア  
ただし「作るだけでお金がかかる」  

✅ 概要

- Internet Gateway = 正門（外と自由に出入りできる）
- NAT Gateway = 裏口（出るだけ、入れない）
- Gateway型 Endpoint = 特定サービス専用の直通通路（無料）
- Interface型 Endpoint = サービスごとに作れる専用ドア（有料）

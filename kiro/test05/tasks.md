# 実装計画

- [x] 1. Laravelプロジェクトの初期設定とベース構造の構築
  - 新しいLaravelプロジェクトを作成し、基本設定を行う
  - データベース接続設定とマイグレーション環境を整備する
  - Bootstrap 5を導入し、基本レイアウトテンプレートを作成する
  - _要件: 8.1, 8.2_

- [x] 2. 認証システムの実装
  - Laravel Breezeまたは手動でログイン機能を実装する
  - ユーザー認証ミドルウェアを設定する
  - ログイン・ログアウト機能のテストを作成する
  - _要件: 8.1, 8.2, 8.3, 8.4, 8.5_

- [x] 3. データベーステーブルとモデルの作成
- [x] 3.1 ユーザー（スタッフ）テーブルとモデルの実装
  - usersテーブルのマイグレーションを作成する（name, email, password, department, position, role）
  - Userモデルにリレーションとアクセサーを実装する
  - ユーザーモデルの単体テストを作成する
  - _要件: 1.1, 1.4, 8.4_

- [x] 3.2 紹介元テーブルとモデルの実装
  - referral_sourcesテーブルのマイグレーションを作成する（name, phone, contact_person）
  - ReferralSourceモデルを実装する
  - 紹介元モデルの単体テストを作成する
  - _要件: 2.1, 2.4_

- [x] 3.3 医師テーブルとモデルの実装
  - doctorsテーブルのマイグレーションを作成する（name, specialty）
  - Doctorモデルを実装する
  - 医師モデルの単体テストを作成する
  - _要件: 3.1, 3.4_

- [x] 3.4 案件テーブルとモデルの実装
  - casesテーブルのマイグレーションを作成する（patient_name, referral_source_id, assigned_user_id, doctor_id, desired_admission_date, medical_condition, status, priority, notes）
  - Caseモデルにリレーションとスコープを実装する
  - 案件モデルの単体テストを作成する
  - _要件: 4.1, 4.3, 4.4, 5.2_

- [x] 3.5 案件履歴テーブルとモデルの実装
  - case_historiesテーブルのマイグレーションを作成する（case_id, user_id, action, description）
  - CaseHistoryモデルを実装する
  - 案件履歴モデルの単体テストを作成する
  - _要件: 4.5, 4.6_

- [x] 4. スタッフ管理機能の実装
- [x] 4.1 スタッフ登録機能の実装
  - StaffControllerを作成し、create/storeメソッドを実装する
  - スタッフ登録フォームのBladeテンプレートを作成する
  - フォームバリデーション（StaffRequest）を実装する
  - スタッフ登録機能のテストを作成する
  - _要件: 1.1, 1.2, 1.3_

- [x] 4.2 スタッフ一覧・編集・削除機能の実装
  - StaffControllerのindex/show/edit/update/destroyメソッドを実装する
  - スタッフ一覧・詳細・編集のBladeテンプレートを作成する
  - スタッフ管理機能の統合テストを作成する
  - _要件: 1.4, 1.5_

- [x] 5. 紹介元管理機能の実装
- [x] 5.1 紹介元登録機能の実装
  - ReferralSourceControllerを作成し、CRUD操作を実装する
  - 紹介元登録・編集フォームのBladeテンプレートを作成する
  - フォームバリデーション（ReferralSourceRequest）を実装する
  - _要件: 2.1, 2.2, 2.3_

- [x] 5.2 紹介元一覧・編集機能の実装
  - 紹介元一覧・詳細表示のBladeテンプレートを作成する
  - 紹介元管理機能のテストを作成する
  - _要件: 2.4, 2.5_

- [x] 6. 医師管理機能の実装
- [x] 6.1 医師登録機能の実装
  - DoctorControllerを作成し、CRUD操作を実装する
  - 医師登録・編集フォームのBladeテンプレートを作成する
  - フォームバリデーション（DoctorRequest）を実装する
  - _要件: 3.1, 3.2, 3.3_

- [x] 6.2 医師一覧・専門科別表示機能の実装
  - 医師一覧を専門科別に表示するBladeテンプレートを作成する
  - 医師管理機能のテストを作成する
  - _要件: 3.4, 3.5_

- [x] 7. 案件管理機能の実装
- [x] 7.1 案件登録機能の実装
  - CaseControllerを作成し、create/storeメソッドを実装する
  - 案件登録フォームのBladeテンプレートを作成する（紹介元・医師選択のドロップダウン含む）
  - フォームバリデーション（CaseRequest）を実装する
  - 案件ID自動生成機能を実装する
  - _要件: 4.1, 4.2, 4.3_

- [x] 7.2 案件詳細表示・編集機能の実装
  - CaseControllerのshow/edit/updateメソッドを実装する
  - 案件詳細・編集のBladeテンプレートを作成する
  - 案件ステータス変更時の履歴記録機能を実装する
  - _要件: 4.4, 4.5, 4.6_

- [x] 8. 担当者別案件一覧機能の実装
- [x] 8.1 担当者別案件一覧表示の実装
  - CaseAssignmentControllerを作成する
  - 担当者別案件一覧のBladeテンプレートを作成する
  - ステータス別フィルタリング機能を実装する
  - _要件: 5.1, 5.2, 5.3_

- [x] 8.2 緊急度表示と案件詳細遷移の実装
  - 緊急度による優先表示機能を実装する
  - 案件クリック時の詳細画面遷移を実装する
  - 担当者別案件機能のテストを作成する
  - _要件: 5.4, 5.5_

- [x] 9. 案件検索機能の実装
- [x] 9.1 検索フォームと基本検索の実装
  - CaseSearchControllerを作成する
  - 検索フォームのBladeテンプレートを作成する
  - 患者名・案件ID・紹介元による検索機能を実装する
  - _要件: 6.1, 6.2_

- [x] 9.2 複合検索と検索結果表示の実装
  - 日付範囲検索機能を実装する
  - 複数条件のAND検索機能を実装する
  - 検索結果表示と案件詳細遷移を実装する
  - 検索機能のテストを作成する
  - _要件: 6.3, 6.4, 6.5_

- [x] 10. カレンダー表示機能の実装
- [x] 10.1 月次カレンダー表示の実装
  - CalendarControllerを作成する
  - 月次カレンダーのBladeテンプレートを作成する
  - 各日付の案件数表示機能を実装する
  - _要件: 7.1, 7.2_

- [x] 10.2 カレンダー操作機能の実装
  - 日付クリック時の案件一覧表示機能を実装する
  - ステータス別の色分け表示機能を実装する
  - 前月・次月ナビゲーション機能を実装する
  - 案件詳細遷移機能を実装する
  - カレンダー機能のテストを作成する
  - _要件: 7.3, 7.4, 7.5, 7.6_

- [x] 11. ダッシュボード機能の実装
- [x] 11.1 ダッシュボードコントローラーの実装
  - DashboardControllerを作成し、統計データ取得メソッドを実装する
  - 総案件数、ステータス別案件数、優先度別案件数の集計機能を実装する
  - 最新案件一覧取得機能を実装する
  - 今日の入院予定案件取得機能を実装する
  - _要件: 8.1, 8.2, 8.4, 8.6_

- [x] 11.2 ダッシュボードビューの改善
  - 統計データを正しく表示するようにBladeテンプレートを修正する
  - データが存在しない場合の適切な表示を実装する
  - ダッシュボード機能のテストを作成する
  - _要件: 8.3, 8.5_

- [ ] 12. 権限管理とセキュリティの実装
- [ ] 12.1 ロールベース権限制御の実装
  - 権限チェックミドルウェアを実装する
  - 管理者・スタッフ権限による機能制限を実装する
  - 権限管理のテストを作成する
  - _要件: 9.4_

- [ ] 12.2 セキュリティ対策の実装
  - CSRF保護の設定を確認・実装する
  - 入力値サニタイゼーション機能を実装する
  - セッション管理の設定を実装する
  - セキュリティ機能のテストを作成する
  - _要件: 9.5_

- [ ] 13. UI/UX改善とエラーハンドリング
- [ ] 13.1 エラーハンドリングの実装
  - カスタムエラーページを作成する
  - バリデーションエラーの日本語化を実装する
  - 例外処理とログ出力機能を実装する
  - エラーハンドリングのテストを作成する
  - _要件: 全般_

- [ ] 13.2 UI/UX最終調整
  - フラッシュメッセージ表示機能を実装する
  - ナビゲーションメニューを完成させる
  - レスポンシブ対応の最終確認を行う
  - 基本的なJavaScriptによる操作性向上を実装する
  - _要件: 全般_

- [ ] 14. テストとデプロイ準備
- [ ] 14.1 統合テストの実装
  - E2Eテスト（Laravel Dusk）を作成する
  - 全機能の統合テストを実行する
  - テストカバレッジを確認する
  - _要件: 全般_

- [ ] 14.2 本番環境準備
  - 本番用設定ファイルを作成する
  - データベースシーダーを作成する
  - デプロイ手順書を作成する
  - _要件: 全般_
